# 基于TCP/IP的多线程实战——多线程客户端聊天室的本地实现，通过局域网IP
## 流程

<details><summary><b>要点</b></summary>
  
- 使用的是Winsock2库和windows库
- 总共两个程序，一个服务器程序，一个客户端程序
</details>
<details><summary><b>服务器</b></summary>
  
- 1.通过WSAStartup函数确认协议版本
- 2.通过socket函数创建服务器socket变量
- 3.设置服务器协议地址簇，通过声明一个sock_address_in变量，就是大写的SOCKADDR_IN变量，然后设置网络地址就是本地的局域网IP，再设置端口号
- 4.通过bind函数绑定第二步创建的socket和第三步设置的服务器协议地址簇变量
- 5.通过listen函数让socket变量监听，同时设置最大允许连接的客户端数量
- 6.连接和通信
    - 这一步也就是多线程的核心部分
    - 用for循环跑多个客户端线程，事先声明存储客户端的SOCKET数组，然后for循环内每次都用accept函数去接听服务器socket
    - 然后通过CreateThread函数去创建一个线程，这个函数内给定的传入参数就是客户端通信的函数
    - 客户端通信的函数内就是进行一个while（1）无限循环，然后用一个buf数组和当前这次循环的客户端socket变脸作为参数传给recv函数，这样服务器就能收到这个客户端发来的消息了，用buf数组存储，然后再打印出来，供其它客户端查看，达到模拟多个客户端聊天室通信的功能
    - 然后因为这创建线程的操作是在for循环内的，所以有多少客户端就跑了几次for循环，实现多线程客户端和同一个服务端的聊天室通信
    - 这里的通信是每个客户端将自己的消息发送给服务端，然后通过一起查看客户端打印的数据进行通信的
- 7.之后就是通过closesocket断开连接，还有WSACleanup清理协议版本信息
</details>

---

- 然后客户端的做的事情就是比服务端少了绑定和监听，直接连接服务器就行了
- 然后模拟聊天的过程就是就是，先点开服务器的exe执行程序，再点开多个客户端程序的exe执行程序，每点一个客户端exe程序，在服务器窗口上就会显示已连接一个客户端，然后我们就可以在客户端exe窗口上输入文字，就会在服务器exe窗口上打印出来，当然事先要准备好足够多的客户端socket数组，不然超过最大连接客户端数就会出错。

